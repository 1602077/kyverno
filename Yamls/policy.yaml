apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: replace-image-registry
  annotations:
    policies.kyverno.io/severity: medium
    policies.kyverno.io/subject: Pod
    policies.kyverno.io/minversion: 1.3.6
spec:
  background: false
  rules:
    - name: replace-image-registry
      match:
        resources:
          kinds:
            - Pod
      mutate:
        patchStrategicMerge:
          spec:
            containers:
              - (name): "*"
                image: |-
                  {{ regex_replace_all('^((?!.*.ocir.io).*?)\/', '{{@}}', 'phx.ocir.io/something/') }}
